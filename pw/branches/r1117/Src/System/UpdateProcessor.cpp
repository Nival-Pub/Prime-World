#include "stdafx.h"
#include "UpdateProcessor.h"

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
namespace Updater
{
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CUpdateProcessor::OnSerialize( IBinSaver &f )
{
	if ( f.IsReading() )
		SubscribeUpdates();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CUpdateProcessor::Process( CObjectBase *pUpdate )
{
	const int nTypeID = pUpdate->GetTypeId();
	TProcessorFuncs::iterator pos = updateProcessorFuncs.find( nTypeID );
	if ( pos != updateProcessorFuncs.end() )
	{
		IUpdateProcessorFunc *pProcessor = pos->second;
		pProcessor->Process( pUpdate );
	}
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
using namespace Updater;
BASIC_REGISTER_CLASS( IUpdateProcessorFunc );
BASIC_REGISTER_CLASS( CUpdateProcessor );

